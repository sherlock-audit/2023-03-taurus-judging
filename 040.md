roguereddwarf

medium

# SwapHandler can by mistake send too many tokens to UniswapSwapAdapter which means that yield is lost and can be stolen by anyone

## Summary
The [`SwapHandler.swapForTau`](https://github.com/sherlock-audit/2023-03-taurus/blob/main/taurus-contracts/contracts/Vault/SwapHandler.sol#L45-L101) function can be called by keepers allowing users to swap yield that is generated by the collateral for `TAU` such that they can be rewarded.

As part of this process, the `SwapHandler.swapForTau` function sends yield to the SwapAdapter. Currently only `UniswapSwapAdapter` is implemented.

The keeper needs to specify the `_yieldTokenAmount`, i.e. the amount of yield token to be processed, next it needs to specify an `_amountIn` as well which is part of the `_swapParams` bytes.

The issue happens when more yield token is sent to the `UniswapSwapAdapter` than is swapped.
The excess amount is not sent back to the `SwapHandler`.
Anyone can call `UniswapSwapAdapter.swap` and swap the excess yield token for `TAU` and steal it.

## Vulnerability Detail
Let's assume a keeper calls `SwapHandler.swapForTau`.
https://github.com/sherlock-audit/2023-03-taurus/blob/main/taurus-contracts/contracts/Vault/SwapHandler.sol#L45-L52

Further assume `_yieldTokenAmount = 100e18` and `_amountIn = 90e18` (`_amountIn` is encoded in `_swapParams`).
If say a 3% fee is subtracted from `_yieldTokenAmount`, `97e18` will be sent to `UniswapSwapAdapter`:
https://github.com/sherlock-audit/2023-03-taurus/blob/main/taurus-contracts/contracts/Vault/SwapHandler.sol#L70-L75

However the `UniswapSwapHandler.swap` function only swaps `_amountIn` tokens:
https://github.com/sherlock-audit/2023-03-taurus/blob/main/taurus-contracts/contracts/SwapAdapters/UniswapSwapAdapter.sol#L38-L44

This means the difference of `7e18` remains in the `UniswapSwapHandler` and can be swapped for `TAU` and withdrawn by anyone.

Even if the keeper has performed the correct calculation, before the transaction is executed the multisig role might change the protocol fee percentage (reduce it) such that yield is then lost.

## Impact
If a keeper specifies a wrong amount (which can easily happen as shown above) anyone can swap and steal the excess yield token which leads to a loss for users of the protocol.

## Code Snippet
https://github.com/sherlock-audit/2023-03-taurus/blob/main/taurus-contracts/contracts/Vault/SwapHandler.sol#L45-L101

https://github.com/sherlock-audit/2023-03-taurus/blob/main/taurus-contracts/contracts/SwapAdapters/UniswapSwapAdapter.sol#L21-L47

## Tool used
Manual Review

## Recommendation
There are different possible solutions for this issue.

One is to send excess yield token that is left in the `UniswapSwapAdapter` back to the `SwapHandler`.

Another solution is to provide the `swapAmount` that is calculated in the `SwapHandler` to the `UniswapSwapAdapter`. The `UniswapSwapAdapter` can then use this `swapAmount` as the input amount for the swap instead of using a value provided by the keeper.
